[gd_scene load_steps=23 format=3 uid="uid://jwmpmr20n40m"]

[ext_resource type="Script" path="res://Scripts/Player.gd" id="1_wwex1"]
[ext_resource type="PackedScene" uid="uid://ddc8j5fsi2rdc" path="res://HealthSystem.tscn" id="2_1fmnw"]
[ext_resource type="Script" path="res://Scripts/AttackSystem.gd" id="2_2nppm"]
[ext_resource type="Script" path="res://Scripts/LineDrawer.gd" id="2_nfbc4"]
[ext_resource type="Texture2D" uid="uid://bqyrcjomob3vk" path="res://Sprites/Player.png" id="3_8cno4"]
[ext_resource type="Texture2D" uid="uid://bmws0v53bodpa" path="res://Sprites/PlayerHurtbox.png" id="4_7p6tv"]
[ext_resource type="PackedScene" uid="uid://bbolx8a630ljg" path="res://Projectile.tscn" id="5_6w3up"]
[ext_resource type="Script" path="res://Scripts/ProjectileGenerator.gd" id="6_ykelv"]
[ext_resource type="PackedScene" uid="uid://dxsmy4ea4657t" path="res://LoopHitbox.tscn" id="7_rq6yi"]
[ext_resource type="Script" path="res://Scripts/AimSystem.gd" id="10_u7ckr"]
[ext_resource type="Script" path="res://Scripts/Resources/ProjectileGeneratorStep.gd" id="10_ysd5r"]
[ext_resource type="Script" path="res://Scripts/Enemy.gd" id="12_dhr3g"]
[ext_resource type="Texture2D" uid="uid://3qdggpkx14la" path="res://Sprites/Enemy.png" id="12_nsuc7"]

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_7uytu"]

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_mlu26"]
normal = Vector2(-1, 0)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_rexeu"]
normal = Vector2(1, 0)

[sub_resource type="WorldBoundaryShape2D" id="WorldBoundaryShape2D_y8ugp"]
normal = Vector2(0, 1)

[sub_resource type="RectangleShape2D" id="RectangleShape2D_eq0el"]
size = Vector2(16, 16)

[sub_resource type="CircleShape2D" id="CircleShape2D_puqmc"]
radius = 3.0

[sub_resource type="CircleShape2D" id="CircleShape2D_bfl4m"]
radius = 8.0

[sub_resource type="CircleShape2D" id="CircleShape2D_hhbvq"]
radius = 7.0

[sub_resource type="Resource" id="Resource_s47om"]
script = ExtResource("10_ysd5r")
skip = false
spawn_position_parent_path = NodePath("Aim")
projectile_scene = ExtResource("5_6w3up")
aim_rotation_source_path = NodePath("../AimSystem")
aim_type = 1
position_offset = Vector2(0, 0)
rotation_offset_degrees = 0.0
spawn_delay = 0.2
transition_delay = 0.5
spawn_cycles = 3
step_cycles = 1

[node name="Game" type="Node2D"]

[node name="GameWalls" type="StaticBody2D" parent="."]
collision_layer = 4
collision_mask = 0

[node name="1" type="CollisionShape2D" parent="GameWalls"]
position = Vector2(128, 256)
shape = SubResource("WorldBoundaryShape2D_7uytu")

[node name="2" type="CollisionShape2D" parent="GameWalls"]
position = Vector2(256, 128)
shape = SubResource("WorldBoundaryShape2D_mlu26")

[node name="3" type="CollisionShape2D" parent="GameWalls"]
position = Vector2(0, 128)
shape = SubResource("WorldBoundaryShape2D_rexeu")

[node name="4" type="CollisionShape2D" parent="GameWalls"]
position = Vector2(128, 0)
shape = SubResource("WorldBoundaryShape2D_y8ugp")

[node name="EnemyPatrolPoints" type="Node" parent="."]

[node name="1" type="Marker2D" parent="EnemyPatrolPoints"]
position = Vector2(32, 64)

[node name="2" type="Marker2D" parent="EnemyPatrolPoints"]
position = Vector2(224, 64)

[node name="3" type="Marker2D" parent="EnemyPatrolPoints"]
position = Vector2(128, 48)

[node name="4" type="Marker2D" parent="EnemyPatrolPoints"]
position = Vector2(128, 80)

[node name="Player" type="CharacterBody2D" parent="."]
position = Vector2(128, 128)
collision_layer = 0
collision_mask = 4
script = ExtResource("1_wwex1")

[node name="Bounds" type="CollisionShape2D" parent="Player"]
shape = SubResource("RectangleShape2D_eq0el")

[node name="Hurtbox" type="Area2D" parent="Player"]
collision_layer = 0
collision_mask = 3
metadata/Area2DType = "Hurtbox"

[node name="HurtboxShape" type="CollisionShape2D" parent="Player/Hurtbox"]
position = Vector2(0, 3)
shape = SubResource("CircleShape2D_puqmc")

[node name="HealthSystem" parent="Player" instance=ExtResource("2_1fmnw")]

[node name="AttackSystem" type="Node" parent="Player"]
script = ExtResource("2_2nppm")
polygon_scene = ExtResource("7_rq6yi")

[node name="LineDrawer" type="Line2D" parent="Player/AttackSystem" node_paths=PackedStringArray("tracked_node")]
top_level = true
z_index = -1
position = Vector2(0, 3)
width = 3.0
default_color = Color(0.564706, 0.952941, 0.976471, 1)
joint_mode = 2
begin_cap_mode = 2
end_cap_mode = 2
script = ExtResource("2_nfbc4")
tracked_node = NodePath("../..")
max_points = 25
min_distance = 6.0

[node name="Sprite" type="Sprite2D" parent="Player"]
texture = ExtResource("3_8cno4")

[node name="HurtboxSprite" type="Sprite2D" parent="Player"]
z_index = 1
position = Vector2(0, 3)
texture = ExtResource("4_7p6tv")

[node name="Enemy" type="CharacterBody2D" parent="." node_paths=PackedStringArray("patrol_point_parent", "target_node")]
position = Vector2(128, 48)
collision_mask = 4
script = ExtResource("12_dhr3g")
patrol_point_parent = NodePath("../EnemyPatrolPoints")
target_node = NodePath("../Player")

[node name="Bounds" type="CollisionShape2D" parent="Enemy"]
shape = SubResource("CircleShape2D_bfl4m")

[node name="Hurtbox" type="Area2D" parent="Enemy"]
collision_layer = 0
collision_mask = 2

[node name="HurtboxShape" type="CollisionShape2D" parent="Enemy/Hurtbox"]
shape = SubResource("CircleShape2D_hhbvq")

[node name="HealthSystem" parent="Enemy" instance=ExtResource("2_1fmnw")]
max_health = 6

[node name="AimSystem" type="Node2D" parent="Enemy" node_paths=PackedStringArray("aim_target")]
script = ExtResource("10_u7ckr")
aim_target = NodePath("../../Player")

[node name="ProjectileGenerator" type="Node2D" parent="Enemy"]
script = ExtResource("6_ykelv")
run_forever = true
steps = Array[ExtResource("10_ysd5r")]([SubResource("Resource_s47om")])

[node name="Aim" type="Node2D" parent="Enemy/ProjectileGenerator"]

[node name="Marker2D" type="Marker2D" parent="Enemy/ProjectileGenerator/Aim"]
position = Vector2(8, 0)

[node name="Sprite" type="Sprite2D" parent="Enemy"]
texture = ExtResource("12_nsuc7")

[connection signal="area_entered" from="Player/Hurtbox" to="Player" method="_on_hurtbox_area_entered"]
[connection signal="body_entered" from="Player/Hurtbox" to="Player" method="_on_hurtbox_body_entered"]
[connection signal="health_zeroed" from="Player/HealthSystem" to="Player" method="_on_health_zeroed"]
[connection signal="loop_created" from="Player/AttackSystem/LineDrawer" to="Player/AttackSystem" method="_on_loop_created"]
[connection signal="area_entered" from="Enemy/Hurtbox" to="Enemy" method="_on_hurtbox_area_entered"]
[connection signal="health_zeroed" from="Enemy/HealthSystem" to="Enemy" method="_on_health_zeroed"]
